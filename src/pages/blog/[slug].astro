---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import { getContentfulEntries } from '../../lib/contentful';
import { documentToHtmlString } from '@contentful/rich-text-html-renderer';

export async function getStaticPaths() {
  if (!import.meta.env.CONTENTFUL_SPACE_ID || !import.meta.env.CONTENTFUL_ACCESS_TOKEN) {
    console.error('Contentful credentials are missing');
    return [];
  }

  try {
    const entries = await getContentfulEntries('blogPost');
    return entries.map((item) => ({
      params: { slug: item.fields.slug },
      props: { post: item },
    }));
  } catch (error) {
    console.error('Error fetching blog posts for static paths:', error);
    return [];
  }
}

const { post } = Astro.props;

if (!post) {
  return Astro.redirect('/404');
}

const {
  title,
  date,
  author,
  readingTime,
  categories,
  content,
} = post.fields;

const htmlContent = content ? documentToHtmlString(content) : '';
---

<Layout title={title}>
  <Header />
  <main>
    <article class="blog-post">
      <h1>{title}</h1>
      <section class="metadata">
        <h2>/ METADATA</h2>
        <dl>
          <dt>DATE:</dt>
          <dd>{new Date(date).toISOString().split('T')[0]}</dd>
          <dt>AUTHOR:</dt>
          <dd>{author}</dd>
          <dt>READING TIME:</dt>
          <dd>{readingTime} MINUTES</dd>
          <dt>CATEGORIES:</dt>
          <dd>{categories ? categories.join(', ') : 'N/A'}</dd>
        </dl>
        <div class="share">
          <h3>SHARE:</h3>
          <button>Twitter/X</button>
          <button>LinkedIn</button>
        </div>
      </section>
      <section class="content" set:html={htmlContent} />
    </article>
  </main>
</Layout>

<style>
  /* ... (keep existing styles) ... */
</style>